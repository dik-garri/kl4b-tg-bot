# KL4B Bot ‚Äî –¢—Ä–µ–∫–µ—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–Ω–∏–∂–Ω–æ–≥–æ –∫–ª—É–±–∞

Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É—á–∞—Å—Ç–∏—è –≤ –∫–Ω–∏–∂–Ω–æ–º –∫–ª—É–±–µ KL4B (–ö–ª—É–± –õ—é–±–∏—Ç–µ–ª–µ–π —á—Ç–µ–Ω–∏—è –ë–∏–±–ª–∏–∏).

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –±–æ—Ç

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–æ–ø–∏–∫–µ "–ú—ã—Å–ª–∏ –ø–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–º—É"
- –í–µ–¥—ë—Ç —É—á—ë—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å–∏—Å—Ç–µ–º—É —Å—Ç—Ä–∞–π–∫–æ–≤ (< 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é = —Å—Ç—Ä–∞–π–∫)
- –ò—Å–∫–ª—é—á–∞–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ—Å–ª–µ 3 —Å—Ç—Ä–∞–π–∫–æ–≤
- –°–Ω–∏–º–∞–µ—Ç 1 —Å—Ç—Ä–∞–π–∫ –∑–∞ 2 –ø–æ–¥—Ä—è–¥ —Ö–æ—Ä–æ—à–∏–µ –Ω–µ–¥–µ–ª–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–º–æ—Ä–æ–∑–∫–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è
- –ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –ø–æ—Å—Ç–∏—Ç PNG-–æ—Ç—á—ë—Ç –≤ —Ç–æ–ø–∏–∫ "–û–±—ä—è–≤–ª–µ–Ω–∏—è"

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend:** Google Apps Script
- **Database:** Google Sheets
- **API:** Telegram Bot API

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
kl4b/
‚îú‚îÄ‚îÄ gas/                        # Google Apps Script –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ appsscript.json         # –ú–∞–Ω–∏—Ñ–µ—Å—Ç GAS
‚îÇ   ‚îú‚îÄ‚îÄ Code.gs                 # –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ (doPost, doGet)
‚îÇ   ‚îú‚îÄ‚îÄ SheetHelpers.gs         # –†–∞–±–æ—Ç–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ Logging.gs              # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ TelegramApi.gs          # Telegram Bot API
‚îÇ   ‚îú‚îÄ‚îÄ Members.gs              # CRUD –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ Messages.gs             # –†–∞–±–æ—Ç–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ Webhook.gs              # –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook
‚îÇ   ‚îî‚îÄ‚îÄ WeeklyReport.gs         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ plans/                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø–ª–∞–Ω—ã
‚îî‚îÄ‚îÄ CLAUDE.md                   # –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è Claude Code
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ –≤ Telegram

–ß–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather):
- `/newbot` ‚Üí –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
- –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### 2. –°–æ–∑–¥–∞—Ç—å Google Spreadsheet

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID –∏–∑ URL:
```
https://docs.google.com/spreadsheets/d/{SHEET_ID}/edit
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Google Apps Script

1. –û—Ç–∫—Ä—ã—Ç—å [script.google.com](https://script.google.com)
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç "KL4B Bot"
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ `.gs` —Ñ–∞–π–ª—ã –∏–∑ `gas/`
4. –í Project Settings –≤–∫–ª—é—á–∏—Ç—å "Show appsscript.json manifest file" –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `appsscript.json`

### 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Script Properties

Project Settings ‚Üí Script Properties:

| –ö–ª—é—á | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| SHEET_ID | ID Google Spreadsheet |
| BOT_TOKEN | –¢–æ–∫–µ–Ω –æ—Ç BotFather |
| GROUP_CHAT_ID | ID –≥—Ä—É–ø–ø—ã (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ) |
| TARGET_THREAD_ID | ID —Ç–æ–ø–∏–∫–∞ "–ú—ã—Å–ª–∏ –ø–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–º—É" |
| REPORT_THREAD_ID | ID —Ç–æ–ø–∏–∫–∞ "–û–±—ä—è–≤–ª–µ–Ω–∏—è" |

### 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `setupSheets()` –æ–¥–∏–Ω —Ä–∞–∑.

### 6. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –∫–∞–∫ Web App

Deploy ‚Üí New deployment:
- Type: Web app
- Execute as: Me
- Who has access: Anyone

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL –¥–µ–ø–ª–æ—è.

### 7. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook

```
https://api.telegram.org/bot{TOKEN}/setWebhook?url={DEPLOYMENT_URL}
```

### 8. –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤

Triggers ‚Üí Add Trigger:
- Function: `runWeeklyReport`
- Event source: Time-driven
- Type: Week timer
- Day: Sunday
- Time: 21:00

## –ü–æ–ª—É—á–µ–Ω–∏–µ ID —Ç–æ–ø–∏–∫–æ–≤

–ü–µ—Ä–µ—Å–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ —Ç–æ–ø–∏–∫–∞ –±–æ—Ç—É [@userinfobot](https://t.me/userinfobot) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `getUpdates`:
```
https://api.telegram.org/bot{TOKEN}/getUpdates
```

## –ó–∞–º–æ—Ä–æ–∑–∫–∏

–î–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–º–æ—Ä–æ–∑–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞ (–æ—Ç–ø—É—Å–∫, –±–æ–ª–µ–∑–Ω—å):
1. –û—Ç–∫—Ä—ã—Ç—å Google Spreadsheet
2. –í –ª–∏—Å—Ç–µ `members` –Ω–∞–π—Ç–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞
3. –í —Å—Ç–æ–ª–±—Ü–µ `frozen_until` —É–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è –∑–∞–º–æ—Ä–æ–∑–∫–∏ (YYYY-MM-DD)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```javascript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
testConfig();

// –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç
integrationTest();

// –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –æ—Ç—á—ë—Ç–∞
runWeeklyReport();
```

## –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –ü–æ–¥—Å—á—ë—Ç —Å—É—Ç–æ–∫

–°—É—Ç–∫–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è —Å **4:00 –¥–æ 4:00** –ø–æ –≤—Ä–µ–º–µ–Ω–∏ GMT+6 (–ë–∏—à–∫–µ–∫). –°–æ–æ–±—â–µ–Ω–∏–µ –≤ 3:00 –Ω–æ—á–∏ –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å.

### –°—Ç—Ä–∞–π–∫–∏

| –£—Å–ª–æ–≤–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|
| ‚â•3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π | good_weeks += 1 |
| <3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π | strikes += 1, good_weeks = 0, trophies = 0 |
| 2 —Ö–æ—Ä–æ—à–∏—Ö –Ω–µ–¥–µ–ª–∏ –ø–æ–¥—Ä—è–¥ + strikes > 0 | strikes -= 1, good_weeks = 0 |
| strikes >= 3 | status = expelled |
| frozen_until –≤ –±—É–¥—É—â–µ–º | –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–µ–¥–µ–ª—é |

### –¢—Ä–æ—Ñ–µ–∏ üèÜ

| –£—Å–ª–æ–≤–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|
| 6 –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π –∏–∑ 6 | trophies += 1 |
| <3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π (—Å—Ç—Ä–∞–π–∫) | trophies = 0 (–æ–±–Ω—É–ª–µ–Ω–∏–µ) |
| 3-5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–Ω–µ–π | trophies –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |

–¢—Ä–æ—Ñ–µ–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è, –Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å—Ç—Ä–∞–π–∫–∞.

**max_trophies** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–æ—Ñ–µ–µ–≤ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `members` –¥–ª—è –≤—ã–¥–∞—á–∏ –ø–æ–¥–∞—Ä–∫–æ–≤. –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –æ—Ç—á—ë—Ç–∞—Ö.

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
